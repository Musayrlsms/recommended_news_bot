<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>G√ºndem Analiz Paneli</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #f8f9fa;
        }
        .hero {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(120deg, #007bff, #6610f2);
            color: white;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: 2.5rem;
            font-weight: bold;
        }
        #status {
            transition: all 0.3s ease;
        }
        .card {
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            border: 1px solid #e3e6ea;
        }
        .table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .table thead th {
            background-color: #007bff;
            color: #fff;
            text-align: center;
            font-weight: 600;
            padding: 12px;
        }
        .table tbody tr:hover {
            background-color: #f1f1f1;
            transition: background 0.3s;
        }
        .table td {
            text-align: center;
            padding: 10px;
            vertical-align: top;
            white-space: normal;
            word-wrap: break-word;
            max-width: 300px;
        }
        .badge-keyword {
            background-color: #e3f2fd;
            color: #0d6efd;
            margin: 2px;
            padding: 5px 8px;
            font-size: 0.85rem;
            border-radius: 6px;
            display: inline-block;
        }
        .doc-item {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            padding: 6px 8px;
            margin: 4px 0;
            border-radius: 5px;
            font-size: 0.9rem;
            text-align: left;
        }
    </style>
</head>
<body class="container py-5">

    <div class="hero mb-5">
        <h1>G√ºndem Analiz Paneli</h1>
        <p>Haber ba≈ülƒ±klarƒ±nƒ± ve Google Trends verilerini analiz ederek g√ºncel konularƒ±n √∂zetini alƒ±n.</p>
        <button class="btn btn-light btn-lg mt-3" onclick="runAnalysis()">üöÄ Analizi Ba≈ülat</button>
    </div>

    <div id="status" class="mt-3 text-center"></div>

    <!-- Chart Section -->
    <div class="card p-4" style="display:none;" id="chart-section">
        <h3 class="mb-3 text-primary">Analiz Grafiƒüi</h3>
        <canvas id="chartCanvas" width="400" height="150"></canvas>
    </div>

    <!-- Table Section -->
    <div class="card p-4" style="display:none;" id="table-section">
        <h3 class="mb-3 text-primary">Analiz Tablosu</h3>
        <div class="table-responsive" id="table-container"></div>
    </div>

    <script>
        function runAnalysis() {
            document.getElementById('status').innerHTML = "<div class='alert alert-info'>‚è≥ Analiz ba≈ülatƒ±lƒ±yor...</div>";
            document.getElementById('chart-section').style.display = "none";
            document.getElementById('table-section').style.display = "none";

            fetch('/run-analysis')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status').innerHTML = `<div class='alert alert-success'>${data.message}</div>`;
                    
                    document.getElementById('table-container').innerHTML = data.table;

                    const table = document.querySelector('#table-container table');
                    if (table) {
                        table.classList.add('table', 'table-striped', 'table-hover', 'table-bordered', 'align-middle');
                        
                        const rows = table.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const cells = row.querySelectorAll('td');
                            if (cells.length >= 5) {
                                const repCol = cells[3];
                                let keywords = repCol.innerText.replace(/\[|\]|'/g, '').split(',');
                                repCol.innerHTML = keywords.map(k => `<span class="badge-keyword">${k.trim()}</span>`).join(' ');

                                const docsCol = cells[4];
                                let docs = docsCol.innerText.replace(/\[|\]|'/g, '').split(',');
                                docsCol.innerHTML = docs.map(d => `<div class="doc-item">${d.trim()}</div>`).join('');
                            }
                        });
                    }

                    document.getElementById('table-section').style.display = "block";

                    document.getElementById('chart-section').style.display = "block";
                    const ctx = document.getElementById('chartCanvas').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'Konu Sayƒ±larƒ±',
                                data: data.values,
                                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Konu Analizi',
                                    font: { size: 18 }
                                }
                            },
                            scales: { y: { beginAtZero: true } }
                        }
                    });
                });
        }
    </script>
</body>
</html>
